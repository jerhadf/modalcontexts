
<html>
    <head>
        <title>Modal Contexts Study</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-categorize-html.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-html-form.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-multi-select.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
        <script type="text/javascript" src="vignettes.js"></script>
        <script type="text/javascript" src="bdi_options.js"></script>
        <script type="text/javascript" src="newtestdata.js"></script>
        <script type="module" src="parseData.js"></script>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <link rel="stylesheet" href="css/style.css">
    </head>
    
    <body></body>
    
    <script>
        /* create timeline */
        var timeline = [];
    
        //Global variables
        vignettes = [vignettes.Alba, vignettes.Eoin, vignettes.Triss, vignettes.Alberto, vignettes.Miriam, vignettes.Ae8056, vignettes.Gerig, vignettes.You1, vignettes.Azrael, vignettes.Kiki, vignettes.Betty, vignettes.You2, vignettes.You3, vignettes.You4, vignettes.Elysia, vignettes.Tobi, vignettes.Duncan];
        VIGNETTE_AMOUNT = vignettes.length;
        var q_array = jsPsych.randomization.sampleWithoutReplacement(vignettes, VIGNETTE_AMOUNT);
        q_i = 0;
        var shuffled_q = [];
    
        //tracks the name of curr vignette 
        var curr_vign_name = null;

        //function to move to the next vignette
        function next_vign() {
            if (q_i == VIGNETTE_AMOUNT) {
                return false;
            }
            else {
                q_i++;
                //get the current vignette name 
                curr_vign_name = q_array[q_i].name;
                q_array[q_i].forEach(element => shuffled_q.push(element));
                shuffled_q = jsPsych.randomization.shuffle(shuffled_q);
                //make sure questions match
                console.log(shuffled_q);
            }
        }
    
        //-------------------------OPENING INSTRUCTIONS-------------------------------
    
        /* Consent form for the study*/
        var consent = {
            type: 'html-button-response',
            stimulus: "<DIV align='left'><div>&nbsp;</div><div>Please consider this information carefully before deciding whether to participate in this research.</div><div>&nbsp;</div><div>The purpose of this research is to examine which factors influence social judgment and decision-</div><div>making. You will be asked to make judgements about individuals and actions in scenarios.</div><div>We are simply interested in your judgement. The study will take less than 1 hour to complete,</div><div>and you will receive less than $20 on Amazon Mechanical Turk. Your compensation and time</div><div>commitment are specified in the study description. There are no anticipated risks associated with</div><div>participating in this study. The effects of participating should be comparable to those you would</div><div>ordinarily experience from viewing a computer monitor and using a mouse or keyboard for a</div><div>similar amount of time. At the end of the study, we will provide an explanation of the questions</div><div>that motivate this line of research and will describe the potential implications.</div><div>&nbsp;</div><div>Your participation in this study is completely voluntary and you may refuse to participate or you</div><div>may choose to withdraw at any time without penalty or loss of benefits to you which are</div><div>otherwise entitled. Your participation in this study will remain confidential. No personally</div><div>identifiable information will be associated with your data. Also, all analyses of the data will be</div><div>averaged across all the participants, so your individual responses will never be specifically</div><div>analyzed.</div><div>&nbsp;</div><div>If you have questions or concerns about your participation or payment, or want to request a</div><div>summary of research findings, please contact Dr. Jonathan Phillips at</div><div><a href=mailto:Jonathan.S.Phillips@dartmouth.edu>Jonathan.S.Phillips@dartmouth.edu</a>.</div><div>&nbsp;</div><div>Please save a copy of this form for your records.</div><div>&nbsp;</div></DIV><div>Agreement:</div><DIV align='left'><div>The nature and purpose of this research have been sufficiently explained and I agree to</div><div>participate in this study. I understand that I am free to withdraw at any time without incurring</div><div>any penalty. Please consent by clicking the button below to continue. Otherwise, please exit the</div><div>study at any time.</div><div>&nbsp;</div></DIV>",
            choices: ['Submit'],
            data:{
                internal_type: "consent"
            },
        };
        timeline.push(consent);
    
        /* Collection of participant info*/
        var participant_info = {
            type: 'survey-text',
            preamble: 'Please provide us with some demographic information.',
            questions: [
                {prompt: "How old are you?", required: true}, 
                {prompt: "Which is your dominant hand?", options: ["Right","Left","Ambidextrous"], required:true}, 
                {prompt: "What is your native language?", required: true}, 
                {prompt: "What is your nationality?", required: true}, 
                {prompt: "In which country do you live?", required: true},
                {prompt: "What is your gender?", options: ["Male","Female","Other"], required:true}, 
                {prompt: "What is your education level?", options: ["Grade/elementary school","High school","Some college or university","College or university degree","Graduate degree, Masters","PhD"], required: true},
                {prompt: "Amazon worker ID", required: true}
            ],
            data:{
                internal_type: "participant_info"
            },
        };
        timeline.push(participant_info);
    
        /* instructions */
        var instructions = {
            type: "html-keyboard-response",
            stimulus: "<h2> Instructions</h2>" +
                "<p>In this study, we'd like you to generate potential responses to a scenario. You will be presented with" +
                "a series of situations. Read the descriptions carefully, and then respond with the first possible responses you think of." +
                " ***Please take your time and answer as thoroughly as possible.*** </p>" +
                "<p>Press any key to continue</p>",
        };
        timeline.push(instructions);
    
        //-------------------------FAMILIARIZATION TRIAL-------------------------------
        
        // I don't think this is needed, removed - see Gokul study for how to do this if needed later
    
        //-------------------------TRIAL 1: FREE RESPONSE-------------------------------

        //actual testing begins here
        var vignette_instructions = {
            type: "html-keyboard-response",
            stimulus: "<h2>In this part, you will read a description of a scenario and then list possible responses to the prompt.</h2> <p>Press any key to continue</p>",
        }
        timeline.push(vignette_instructions);

        //instructions prior to questions 
        var instruct = {
            type: 'instructions',
            data: {
                internal_type: "instructions"
            },
            pages: function() {
                // compiling all relavent questions
                next_vign();
                var story = "<h1>Please read the following story</h1> <br>" + q_array[q_i].vignette + "<br><br>";
                var instruct = "<h1>Please list some options that could possibly be taken in this situation. Seperate each different option with a comma.</h1> <br>";
                return [story, instruct];
            },
            show_clickable_nav: true
        }
    
        //short pause between each stimulus
        var pause = {
            type: 'html-keyboard-response',
            stimulus: "",
            choices: jsPsych.NO_KEYS,
            trial_duration: 500,
        }
        
        //adds each prompt/vignette to the timeline
        function timeline_pusher() {
            console.log("Evaluating question: " + q_i + "with name" +  q_array[q_i].name);
            
            // push instructions to timeline
            timeline.push(instruct);

            // create current question as text prompt
            var curr_question = {
                type: 'survey-text',
                questions: [
                    {prompt: q_array[q_i].prompt, required: true},
                ],
                data:{
                    internal_type: "question"
                },
            };
            
            // add current question to timeline
            timeline.push(curr_question);

        }
        timeline_pusher();


        //-------------------------TRIAL 2: EVALUATION OF PROMPT FAMILIARITY-------------------------------

        // reset the questions to the beginning of the array
        q_i = 0;

        // instructions for evaluation of participant familiarity with prompt 
        var eval_instruct = {
            type: 'instructions',
            data: {
                internal_type: "instructions"
            },
            pages: function() {
                // compiling all relavent questions
                next_vign();
                var story = "<h1>Please read the following story</h1> <br>" + q_array[q_i].vignette + "<br><br>";
                var instruct = "Use the sliding scale to indicate hwo familiar you are with the scenario.";
                return [story, instruct];
            },
            show_clickable_nav: true
        }
    
        // push questions to the timeline
        function timeline_pusher_eval() {
            timeline.push(eval_instruct);

            var eval_trial = {
                type: 'html-slider-response',
                prompt: "Please rate how familiar you are with this scenario on the sliding scale above." + 
                "Extremely familiar means that you encounter scenarios like this almost everyday. Extremely unfamiliar means that you have never even heard of a scenario like this.",
                require_movement: true,
                labels: ["Extremely Familiar", "Very Familiar", "Familiar", "Unfamiliar", "Very Unfamiliar", "Extremely Unfamiliar"],
                data:{
                    internal_type: "slider_response"
                },
            };
                        
            // add current question to timeline
            timeline.push(eval_trial);

        }
        timeline_pusher_eval();
    
        //-------------------------TRIAL ENDS HERE-------------------------------

        // end of experiment 
        /* Function to post the data*/
        function save_data(data) {
            url = location+"data"
            var xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({data}));
        }

        /* start the experiment */
        jsPsych.init({
            timeline: timeline,
            on_finish: function() {
                jsPsych.data.displayData();
                console.log(jsPsych.data.get().values());
                //for server
                save_data(jsPsych.data.get().values());
            }
        });
    </script>
    
    </html>